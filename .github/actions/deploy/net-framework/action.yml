name: Action para desplegar aplicaciones Java Spring Boot 2.5.12
description: 'Esta acción despliega aplicaciones Java Spring Boot 2.5.12'
inputs:
  server_ip:
    description: 'Dirección IP del servidor donde se desplegará la aplicación'
    required: true
  remote_user:
    description: 'Usuario para conectarse al servidor remoto'
    required: true
  project_path:
    description: 'Ruta del proyecto en el servidor remoto'
    required: true
  app_name:
    description: 'Nombre de la aplicación a desplegar'
    required: true
  ip_address:
    description: 'Dirección IP del sitio (dejar vacío para todas las IPs)'
    required: false
runs:
  using: 'composite'
  steps:
    - name: Desplegar en aplicación .NET Framework
      run: |
        echo "Desplegando aplicación .NET Framework en el servidor remoto..."
        ssh ${{ inputs.remote_user }}@${{ inputs.server_ip }} move \"C:\artifacts\net-framework-4\${{ inputs.app_name }}.zip\" \"${{ inputs.project_path }}\"
        echo "Descompresion de artefacto en el servidor remoto..."
        ssh ${{ inputs.remote_user }}@${{ inputs.server_ip }} powershell -Command "Expand-Archive -Path \"${{ inputs.project_path }}\${{ inputs.app_name }}.\" -DestinationPath \"${{ inputs.project_path }}\" -Force"
        echo "Despliegue en aplicación .NET Framework completado..."
      shell: cmd
    - name: Crear App Pool de IIS
      uses: ./orquestador/.github/actions/utils/application-pool/create-app-pool
      with:
        app_pool_name: '${{ inputs.app_name }}-app-pool'
        managed_runtime_version: ''
        managed_pipeline_mode: 'Integrated'
        servidor_remoto: '${{ inputs.server_ip }}'
        usuario: '${{ inputs.remote_user }}'
    - name: Crear Sitio en IIS
      uses: ./orquestador/.github/actions/utils/iis-site/create-iis-site
      with:
        site_name: '${{ inputs.app_name }}'
        app_pool_name: '${{ inputs.app_name }}-app-pool'
        physical_path: '${{ inputs.project_path }}'
        host_header: 'localhost'
        port: '80'
        ip_address: '${{ inputs.ip_address }}'
        servidor_remoto: '${{ inputs.server_ip }}'
        usuario: '${{ inputs.remote_user }}'