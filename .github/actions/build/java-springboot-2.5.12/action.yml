name: Action para compilar aplicaciones Java Spring Boot 2.5.12
description: 'Esta acción compila aplicaciones Java Spring Boot 2.5.12'
inputs:
  server_ip: 
    description: 'Dirección IP del servidor donde se desplegará la aplicación'
    required: true
  remote_user:
    description: 'Usuario para conectarse al servidor remoto'
    required: true
outputs:
  app_name:
    description: 'Nombre de la aplicación compilada'
    value: ${{ steps.get_artifact.outputs.app_name }}
  version:
    description: 'Versión de la aplicación compilada'
    value: ${{ steps.get_artifact.outputs.version }}
  extension:
    description: 'Extensión del artefacto compilado'
    value: ${{ steps.get_artifact.outputs.extension }}
runs:
  using: 'composite'
  steps:
    - name: Compilar aplicación Java Spring Boot 2.5.12
      run: |
        echo "Compilando aplicación Java Spring Boot 2.5.12..."
        mvn clean package -DskipTests
        echo "Compilación completada."
      shell: powershell
      working-directory: ./app
    - name: Obtener nombre, versión y extensión del artefacto desde pom.xml
      run: |
        # Cargar el contenido del archivo pom.xml
        [xml]$pom = Get-Content pom.xml
        # Obtener el nombre y la versión del proyecto
        $projectName = $pom.project.artifactId
        $version = $pom.project.version
        $extension = $pom.project.packaging
        # Retornar el nombre y la versión
        echo "app_name=$projectName" >> $env:GITHUB_OUTPUT
        echo "version=$version" >> $env:GITHUB_OUTPUT
        echo "extension=$extension" >> $env:GITHUB_OUTPUT
      shell: powershell
      working-directory: ./app
    - name: Subir artefactos al servidor remoto
      run: |
        echo "Subiendo artefactos al servidor remoto..."
        try {
          ssh '${{ inputs.remote_user }}'@'${{ inputs.server_ip }}' mkdir -p C:\artifacts\java-springboot-2.5.12
        } catch {
          echo "No se pudo crear el directorio de artefactos, posiblemente ya exista."
        }
        echo "Obteniendo nombre del artefacto..."
        $artifact_name = 
        echo "Cambiando nombre del artefacto..."
        mv ./target/*.war ./target/${{ inputs.app_name }}.war
        scp -r ./target/${{ inputs.app_name }}.war '${{ inputs.remote_user }}'@'${{ inputs.server_ip }}':'C:\artifacts\java-springboot-2.5.12'
        echo "Artefactos subidos."
      shell: powershell
      working-directory: ./app